<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2304979176656635" crossorigin="anonymous"></script><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="GraphQL - Spring GraphQL (not GA)" /><meta property="og:locale" content="en_US" /><meta name="description" content="created : 2021-12-05, updated : 2021-12-05" /><meta property="og:description" content="created : 2021-12-05, updated : 2021-12-05" /><link rel="canonical" href="https://ahnchan.github.io/posts/GraphQL-Spring-GraphQL_M/" /><meta property="og:url" content="https://ahnchan.github.io/posts/GraphQL-Spring-GraphQL_M/" /><meta property="og:site_name" content="Ahnchan" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-12-05T16:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="GraphQL - Spring GraphQL (not GA)" /><meta name="twitter:site" content="@claude_ahn" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-12-05T16:00:00+09:00","datePublished":"2021-12-05T16:00:00+09:00","description":"created : 2021-12-05, updated : 2021-12-05","headline":"GraphQL - Spring GraphQL (not GA)","mainEntityOfPage":{"@type":"WebPage","@id":"https://ahnchan.github.io/posts/GraphQL-Spring-GraphQL_M/"},"url":"https://ahnchan.github.io/posts/GraphQL-Spring-GraphQL_M/"}</script><title>GraphQL - Spring GraphQL (not GA) | Ahnchan</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Ahnchan"><meta name="application-name" content="Ahnchan"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-JLF9MP8SLS"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-JLF9MP8SLS'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div class="site-title mt-3"> <a href="/">Ahnchan</a></div><div class="site-subtitle font-italic">The Infinity To Beyond!</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/ahnchan" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/claude_ahn" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['ahnchan','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>GraphQL - Spring GraphQL (not GA)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>GraphQL - Spring GraphQL (not GA)</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Chanyoung Ahn </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Dec 5, 2021, 4:00 PM +0900" prep="on" > Dec 5, 2021 <i class="unloaded">2021-12-05T16:00:00+09:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2898 words">16 min</span></div></div><div class="post-content"><p>created : 2021-12-05, updated : 2021-12-05</p><h1 id="introduction">Introduction</h1><p>GraphQL은 2015년에 Open Source로 Facebook이 공개하였다. 나는 그 당시는 REST API 위주로 프로젝트를 하고 있어 언젠가는 봐야지하고 미뤄놨던 기술이다. 이번에 Spring GraphQL에 대한 Spring Tips의 동영상을 보고 정리해보기로 했다. Spring GraphQL은 아직 (2021년 11월 현재) GA는 아니고 M2 단계이다. GraphQL이 Spring에 포함되면서 개발 편의성이 높아질 것으로 생각된다.</p><h1 id="라이브러리-설정하기">라이브러리 설정하기</h1><p>Spring GraphQL이 아직 GA가 아니여서 <a href="https://start.spring.io">Spring Initializr</a>에서 SNAPSHOT 으로 선택을 하고 생성해야한다. Repository를 GA가 아닌 부분에서 가져와야 하기 때문이다.</p><h2 id="dependencies">Dependencies</h2><ul><li>Reactive Web Service : Reactive Web을 구현하기 위함.<li>H2 Database : 메모리 데이터베이스<li>Spring Data R2DBC : Reactive 환경에서의 Persist data를 구현하기 위함.<li>Spring GraphQL : graphql 사용을 위함=</ul><p>JDK 17 사용하였다. Source에서 entity를 record를 사용하였다. (JDK 16 부터 정식지원되는 기능이다)</p><p>SNAPSHOT 으로 프로젝트를 만들면 Milestone Repository 를 사용할 수 있다. Spring GraphQL은 아직 M이기 때문에 이 부분이 필요하다.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>	&lt;repository&gt;
		&lt;id&gt;spring-milestones&lt;/id&gt;
		&lt;name&gt;Spring Milestones&lt;/name&gt;
		&lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt;
		&lt;snapshots&gt;
			&lt;enabled&gt;false&lt;/enabled&gt;
		&lt;/snapshots&gt;
	&lt;/repository&gt;

</pre></table></code></div></div><blockquote><p>Note. 해당 Tutorial의 Source는 <a href="https://github.com/ahnchan/tutorial-spring-graphql">GIT Repository</a>에 있다.</p></blockquote><blockquote><p>Note. 처음에 Library를 설정하는 방법이 복잡하니 GIT Repository의 initial 을 사용하면 된다.</p></blockquote><h1 id="database-구성하기">Database 구성하기</h1><p>먼저 구현을 위해 데이터를 정의해보겠다. 시작에서 메모리 DB(H2) 와 R2DBC를 추가했었다. 간단하게 DB를 Product와 Review를 구성해보겠다. main/resource에 schema.sql, data.sql 파일을 만들어 Application이 실행될 때 데이터베이스를 생성하고 데이터를 넣도록 하였다.</p><h2 id="table-설명">Table 설명</h2><ul><li>product : 책정보를 가지고 있다.<li>review: 책에 대한 Review 정보를 가지고 있다.</ul><p>파일은 아래 링크를 참조하여 만들어보자.</p><ul><li><a href="https://github.com/ahnchan/tutorial-spring-graphql/blob/main/complete/graphql/src/main/resources/schema.sql">schema.sql</a><li><a href="https://github.com/ahnchan/tutorial-spring-graphql/blob/main/complete/graphql/src/main/resources/data.sql">data.sql</a></ul><h1 id="graphql-구성하기">GraphQL 구성하기</h1><p>main/resource에 graphql 디렉토리를 생성한다. 해당 디렉토리에 schema.graphql 파일을 만든다. 아래 기능을 구현을 하면서 하나씩 추가를 하기로하고, 먼저 Product에 대해 간단한 서비스를 구성해보자.</p><p>파일: schema.graphql</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>type Query {
    products : [Product]
}

type Product {
    id: ID
    title: String
    author: String
}
</pre></table></code></div></div><p>Query에는 API/Procedure를 등록한다. 해당 부분을 구현해야한다. 넘길 Argument, Return Object등을 등록한다. 이 부분은 products 로 요청하면 Product 배열([]) 로 전달한다. Product는 id, title, author 로 구성이 되어 있다.</p><h1 id="controller-repository-구성하기">Controller, Repository 구성하기</h1><p>이제 구현을 위한 틀을 만들어 보자. 먼저 Controller를 생성해보자.</p><blockquote><p>Note: 폰 튜토리얼의 소스코드는 편의상 한곳(GraphqlApplication.java)에 구현을 하였다. 실제 구현을 할때는 Controller Class, Interface 를 다른 파일로 만들어야 한다.</p></blockquote><p>파일: GraphqlApplication.java</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>@Controller
class ProductGraphqlController {

}
</pre></table></code></div></div><p>Repository, Record를 추가해보자. H2 DB에서 Product 정보를 조회하기 위한 Interface 와 record 이다.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>interface ProductRepository  extends ReactiveCrudRepository&lt;Product, Integer&gt; {
	Flux&lt;Product&gt; findByTitle(String title);
}

record Product(@Id Integer id, String title, String author, String ISBN) {
}
</pre></table></code></div></div><p>Repository를 선언을 하자.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>@Controller
class ProductGraphqlController {

	// Repository
	private ProductRepository productRepository;

	public ProductGraphqlController(ProductRepository productRepository) {
		this.productRepository = productRepository;
}

…
</pre></table></code></div></div><p>이제 큰 구조는 작업을 완료하였다. 다음은 schema.graphsql에서 Query로 선언한 부분을 구현해보자.</p><h1 id="product-조회-전체-구성하기">Product 조회 (전체) 구성하기</h1><p>schema.graphql 에 Query 에 products라는 Method 를 선언하였었다. 전달받은 Arguments는 없고 Product 배열을 반환하게 선언을 하였다. 이 부분을 구현해 보자.</p><p>Controller 안에 아래와 같이 추가를 한다.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>​​@QueryMapping
Flux&lt;Product&gt; products () {
	return this.productRepository.findAll();
}
</pre></table></code></div></div><p>R2DBC(Persist Data)의 기본 Method를 이용하여 모든 정보를 조회하여 반환하도록 한다.</p><h2 id="테스트-하기">테스트 하기</h2><p>이제 테스트를 해보자. Application을 구동하면 아래와 같이 나오는 것을 확인할 수 있다.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>​​  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v2.6.1)

2021-12-07 13:05:23.607  INFO 39671 --- [           main] com.ahnchan.graphql.GraphqlApplication   : Starting GraphqlApplication using Java 17.0.1 on ahnchan-laptop with PID 39671 (/Users/ahnchan/Workspaces/Study/graphql/tutorial-spring-graphql/complete/graphql/target/classes started by ahnchan in /Users/ahnchan/Workspaces/Study/graphql/tutorial-spring-graphql/complete/graphql)
2021-12-07 13:05:23.610  INFO 39671 --- [           main] com.ahnchan.graphql.GraphqlApplication   : No active profile set, falling back to default profiles: default
2021-12-07 13:05:24.304  INFO 39671 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data R2DBC repositories in DEFAULT mode.
2021-12-07 13:05:24.357  INFO 39671 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 48 ms. Found 2 R2DBC repository interfaces.
2021-12-07 13:05:25.460  INFO 39671 --- [           main] o.s.g.b.GraphQlWebFluxAutoConfiguration  : GraphQL endpoint HTTP POST /graphql
2021-12-07 13:05:25.900  INFO 39671 --- [           main] o.s.b.web.embedded.netty.NettyWebServer  : Netty started on port 8080
2021-12-07 13:05:25.912  INFO 39671 --- [           main] com.ahnchan.graphql.GraphqlApplication   : Started GraphqlApplication in 2.774 seconds (JVM running for 3.707)

</pre></table></code></div></div><p>8080 포트로 서비스가 시작되었고 HTTP POST /graphql로 GraphQL Endpoint가 설정되었다고 볼수 있다. Postman과 같이 GraphQL Client를 지원하는 프로그램을 사용해도 되지만 기본으로 제공되는 인터페이스를 사용해보자. 브라우저에서 localhost:8080/graphiql(http://localhost:8080/graphiql) 을 입력하면 아래와 같은 화면이 나온다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/posts/assets/network/graphql/images/graphql-graphiql.png" alt="GraphiQL" width="500" /></p><p>커서가 있는 부분에 아래와 같이 넣고 Play 버튼을 누르면 아래와 같은 결과를 보내준다.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>{
  products {
    id
    title
    author
  }
}
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/posts/assets/network/graphql/images/graphql-products-result.png" alt="GraphiQL Result" width="500" /></p><p>결과값이 오른쪽에 나온다. 필요에 따라 Query에 id, title 만을 입력하여 정보를 선택적으로 받을 수 있다. 요청하는 쪽에서 필요한 정보를 선별(Query)하여 받을 수 있다.</p><h1 id="product-조회시-review-정보를-같이-조회하기">Product 조회시 Review 정보를 같이 조회하기</h1><p>이제 product 내에 review정보를 같이 받아보자. Review 부분은 다른 튜토리얼에서는 Microservice로 단독으로 Application이 존재하나 이곳에서는 한 Application에서 구현하겠다. Microservice로 구현을 하는 부분은 <a href="https://ahnchan.github.io/categories/cloudnative/">Cloud Native 튜토리얼</a>에서 처럼 다양한 방법으로 구현할 수 있다.</p><p>GraphQL 선언에 Review를 추가해보자. 기존의 product 부분에 review를 추가하고 type도 추가하였다.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>type Product {
    id: ID
    title: String
    author: String
    reviews: [Review]
}

type Review {
    id: ID
    productid: Int
    reviewer: String
    text: String
}
</pre></table></code></div></div><p>Product안에 reviews를 선언하고 Review의 배열을 선언하였다.</p><h2 id="review-repository-record-선언하기">Review Repository, record 선언하기</h2><p>Review부분을 선언하였으니 Application에 구현을 해보자. 먼저 Repository, record를 선언하자.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>interface ReviewRepository extends ReactiveCrudRepository&lt;Review, Integer&gt; {
	Flux&lt;Review&gt; findByProductid(Integer productid);
}

record Review(@Id Integer id, Integer productid, String reviewer, String text) {
}
</pre></table></code></div></div><p>ReviewRepository에서 product ID로 Review를 찾는 부분을 추가하였다.<br /> 그리고 Repository 를 생성하는 Constructor에 정의하자.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>	// Repository
	private ProductRepository productRepository;
	private ReviewRepository reviewRepository;

	public ProductGraphqlController(ProductRepository productRepository, ReviewRepository reviewRepository) {
		this.productRepository = productRepository;
		this.reviewRepository = reviewRepository;
	}
</pre></table></code></div></div><h2 id="review-조회-구현하기">Review 조회 구현하기</h2><p>이제 실제 Review를 조회하는 부분이다. reviews는 Product 안에 선언되어 있다. SchemMapping의 Type Name을 Product로 선언하고 reviews는 Method 명으로 구현하였다. Argument는 Product 객체이다. 우리는 이 객체를 받아 id를 가지고 review에서 productid가 같은 Review들을 조회한다.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>@SchemaMapping(typeName = "Product")
Flux&lt;Review&gt; reviews(Product product) {
	return this.reviewRepository.findByProductid(product.id());
}
</pre></table></code></div></div><p>이제 구현은 완료되었다. Application을 재시작하고 테스트를 해보자.</p><h2 id="테스트-하기-1">테스트 하기</h2><p>localhost:8080/graphiql 에서 테스트를 하려면, Refresh를 해줘야 한다. 명령부분에 아래와 같이 요청을 해보자.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>{
  products {
    id
    title
    author
    reviews {
      id
      productid
      reviewer
    }
  }
}
</pre></table></code></div></div><p>요청하는 정보에 reviews 정보가 추가되었고 내용에 id, productid, reviewer를 요청하였다. 결과는 아래와 같이 review 정보를 조회하여 반환하였다.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre>{
  "data": {
    "products": [
      {
        "id": "1",
        "title": "The Keeper of Happy Endings",
        "author": "Barbara Davis",
        "reviews": [
          {
            "id": "1",
            "productid": 1,
            "reviewer": "linda galella"
          },
          {
            "id": "2",
            "productid": 1,
            "reviewer": "Klapaucjusz"
          },
          {
            "id": "5",
            "productid": 1,
            "reviewer": "DisneyDenizen"
          }
        ]
      },
…
</pre></table></code></div></div><h1 id="product-를-추가하기">Product 를 추가하기</h1><p>이제 Product에 정보를 추가해보자. 정보 추가를 위해서는 Mutation 을 선언해야한다. schema.graphql 파일에 정보 추가 부분을 추가해보자.</p><p>파일: schema.graphql</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>type Mutation {
    addProduct(title: String, author: String, ISBN: String): Product
}
</pre></table></code></div></div><h2 id="특정-product-조회하기-구성하기">특정 Product 조회하기 구성하기</h2><p>정보 추가 후에 테스트를 해야하기 때문에 먼저 추가된 Product를 조회하는 부분을 먼저 만들어 보자. Method 선언을 추가하자. ID를 가지고 찾는 Method와 Title을 가지고 찾는 Method를 추가하였다.</p><p>파일: schema.graphql</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>type Query {
    products : [Product]
    productById (id: Int) : Product
    productByTitle (title: String): [Product]
}
</pre></table></code></div></div><p>Application에 선언한 두 Method를 추가해보자.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>@QueryMapping
Flux&lt;Product&gt; productByTitle(@Argument String title) {
	return this.productRepository.findByTitle(title);
}

@QueryMapping
Mono&lt;Product&gt; productById(@Argument Integer id) {
	return this.productRepository.findById(id);
}
</pre></table></code></div></div><h2 id="product-추가하기">Product 추가하기</h2><p>Product를 추가하는 부분을 구현해보자. Annotation은 MutationMapping을 사용한다. addProduct 명칭을 같이 사용하였기에 추가로 Annotation 부분에 선언할 부분은 없다. Arguments로 title, author, ISBN정보를 받고 있다. ProductRepository를 이용하여 저장을 한다.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>@MutationMapping
Mono&lt;Product&gt; addProduct(@Argument String title, @Argument String author, @Argument String ISBN) {
	return this.productRepository.save(new Product(null, title, author, ISBN));
}
</pre></table></code></div></div><h2 id="테스트하기">테스트하기</h2><p>먼저 저장을 해보자. mutation을 이용하여 저장 요청을 한다. 그리고 결과는 Product 정보에서 id, title, author를 받게 하였다.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>mutation {
  addProduct(
    title: "DUNE",
    author: "Frank Herbert",
    ISBN: ""
  ) {
    id
    title
    author
  }
}
</pre></table></code></div></div><p>결과는 아래와 같다.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>{
  "data": {
    "addProduct": {
      "id": "6",
      "title": "DUNE",
      "author": "Frank Herbert"
    }
  }
}
</pre></table></code></div></div><p>이제 조회 Query를 이용하여 지금 등록된 Product를 조회해보자. 아래와 같이 요청을 해보자.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>{
  productByTitle(title: "DUNE") {
    id
    title
    reviews {
      reviewer
      text
    }
  }
}
</pre></table></code></div></div><p>결과는 아래와 같다.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>{
  "data": {
    "productByTitle": [
      {
        "id": "6",
        "title": "DUNE",
        "reviews": []
      }
    ]
  }
}
</pre></table></code></div></div><h1 id="conclusions">Conclusions</h1><p>GraphQL은 요청하는 (보통 Client)에서 자신이 원하는 데이터만 Query 하여 가져가도록 하는 것이다. Client에서도 Query 문법을 익혀야하는 문제도 있지만, 기존 REST API에서는 사용하지 않는 데이터를 받는 경우가 많기 때문에 좀 더 데이터량을 줄이기 위해 많이 사용하고 있다. 또한 통신부분을 GraphQL에서 담당하기 때문에 Client 개발시 통신에 대한 개발 부분(Client 개발자들이 힘들어하는 부분)을 줄일 수 있다.</p><p>GraphQL이 Spring에 포함이 되면서 더 쉽게 사용할 수 있게 되었다. 다음버전에는 GA가 된다고 들었으니 많이 사용할 것 같다.</p><h1 id="references">References</h1><p><a href="https://graphql.org/">GraphQL Foundation</a></p><p><a href="https://www.youtube.com/watch?v=kVSYVhmvNCI">Spring GraphQL - Spring Tips Youtube</a></p><p><a href="https://www.youtube.com/watch?v=Kq3UhUQdIO8&amp;t=1392s">Spring GraphQL</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/network/'>Network</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=GraphQL - Spring GraphQL (not GA) - Ahnchan&url=https://ahnchan.github.io/posts/GraphQL-Spring-GraphQL_M/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=GraphQL - Spring GraphQL (not GA) - Ahnchan&u=https://ahnchan.github.io/posts/GraphQL-Spring-GraphQL_M/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=GraphQL - Spring GraphQL (not GA) - Ahnchan&url=https://ahnchan.github.io/posts/GraphQL-Spring-GraphQL_M/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Platform-kafka-quick-start/">Apache Kafka - Quick Start</a><li><a href="/posts/Install-Jupyterhub_on_Microk8s/">Install JupyterHub on Microk8s</a><li><a href="/posts/Install-Airflow_on_Microk8s/">Install Apache Airflow on Microk8s</a><li><a href="/posts/gRPC-basic-java-step1/">gRPC - Java 환경구성하기, Dummy Service 만들기</a><li><a href="/posts/gRPC-basic-java-step2/">gRPC - Greeting Service 만들기</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav><div style="margin-top:20px;"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2304979176656635" crossorigin="anonymous"></script> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-2304979176656635" data-ad-slot="4120180236" data-ad-format="auto" data-full-width-responsive="true"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2304979176656635" crossorigin="anonymous"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-2304979176656635" data-ad-slot="1066641487"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/gRPC-basic-java-step1/"><div class="card-body"> <span class="timeago small" > Nov 9, 2021 <i class="unloaded">2021-11-09T16:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>gRPC - Java 환경구성하기, Dummy Service 만들기</h3><div class="text-muted small"><p> created : 2021-11-09, updated : 2021-11-09 Introduction Micro Service의 환경이 되면서 점점 더 Service간의 연계가 많아지면서 서비스가 복잡해지고 있다. REST API 로 스펙관리에 한계를 느끼고 있다고 한다. 그래서 다시금 RPC 개념이 사용되고 있다. 기존 RPC를 Google에서 좀...</p></div></div></a></div><div class="card"> <a href="/posts/WebRTC-basic/"><div class="card-body"> <span class="timeago small" > Nov 15, 2021 <i class="unloaded">2021-11-15T16:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>WebRTC Video Chat 만들기</h3><div class="text-muted small"><p> created : 2021-11-15, updated : 2021-11-15 Introduction WebRTC는 Device간의 Video, Audio와 Data까지 Peer to Peer로 통신을 할 수 있게 한다. 통신환경이 좋아져서 적은 사용자의 커넥션에서는 WebRTC가 중간 Streaming 서버 없이도 Device의 자원, 인터넷속도로도...</p></div></div></a></div><div class="card"> <a href="/posts/gRPC-basic-java-step2/"><div class="card-body"> <span class="timeago small" > Nov 21, 2021 <i class="unloaded">2021-11-21T16:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>gRPC - Greeting Service 만들기</h3><div class="text-muted small"><p> created : 2021-11-21, updated : 2021-11-21 Introduction 이전 튜토리얼에서는 gRPC의 기본 개념과 Protocol Buffer와 Dummy Server/Client를 간단하게 만들어 보았다. 이제는 한단계 더 들어가서 데이터를 통신하는 방식을 알아보겠다. Pre-Installation IntelliJ C...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/gRPC-basic-java-step2/" class="btn btn-outline-primary" prompt="Older"><p>gRPC - Greeting Service 만들기</p></a> <a href="/posts/Spring-RSocket/" class="btn btn-outline-primary" prompt="Newer"><p>Spring RSocket & Retrosocket</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/claude_ahn">Chanyoung Ahn</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://ahnchan.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
